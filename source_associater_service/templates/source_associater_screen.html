{% extends "base.html" %}

{% block title %}Source Associater Service{% endblock %}

{% block content %}

<style>
    .share_level { min-height: 50px; min-width: 5px; max-width: 5px; }
    .tlp_WHITE { background-color: white; }
    .tlp_GREEN { background-color: #9FF781; }
    .tlp_AMBER { background-color: #F3F781; }
    .tlp_RED { background-color: #F78181; }
    .query_builder {
        display: inline-block;
    }
    .query_results {
        font-size: "80%";
    }
    .query_results tr td {
        vertical-align: top;
        border-bottom: 1pt solid #ddd;
        word-break: break-all;
        overflow-wrap: break-word;
    }
    .query_results tr td td {
        border: none;
    }
    .find_related_span {
        vertical-align: bottom;
    }
    #results_div {
        max-height: 500px;
        overflow-y: auto;
        word-break: break-all;
        overflow-wrap: break-word;
    }
    #escapingBallG{
        position:relative;
        width:38px;
        height:13px;
        margin:auto;
        padding-top: -3px;
    }

    .escapingBallG{
        background-color:rgba(41,133,204,0.72);
        position:absolute;
        top:3px;
        left:0;
        width:13px;
        height:13px;
        border-radius:7px;
            -o-border-radius:7px;
            -ms-border-radius:7px;
            -webkit-border-radius:7px;
            -moz-border-radius:7px;
        animation-name:bounce_escapingBallG;
            -o-animation-name:bounce_escapingBallG;
            -ms-animation-name:bounce_escapingBallG;
            -webkit-animation-name:bounce_escapingBallG;
            -moz-animation-name:bounce_escapingBallG;
        animation-duration:1.5s;
            -o-animation-duration:1.5s;
            -ms-animation-duration:1.5s;
            -webkit-animation-duration:1.5s;
            -moz-animation-duration:1.5s;
        animation-iteration-count:infinite;
            -o-animation-iteration-count:infinite;
            -ms-animation-iteration-count:infinite;
            -webkit-animation-iteration-count:infinite;
            -moz-animation-iteration-count:infinite;
        animation-timing-function:linear;
            -o-animation-timing-function:linear;
            -ms-animation-timing-function:linear;
            -webkit-animation-timing-function:linear;
            -moz-animation-timing-function:linear;
        animation-delay:0s;
            -o-animation-delay:0s;
            -ms-animation-delay:0s;
            -webkit-animation-delay:0s;
            -moz-animation-delay:0s;
        transform:scale(0.5, 1);
            -o-transform:scale(0.5, 1);
            -ms-transform:scale(0.5, 1);
            -webkit-transform:scale(0.5, 1);
            -moz-transform:scale(0.5, 1);
    }



    @keyframes bounce_escapingBallG{
        0%{
            left:0px;
            transform:scale(0.5, 1);
        }

        25%{
            left:13px;
            transform:scale(1, 0.5);
        }

        50%{
            left:32px;
            transform:scale(0.5, 1);
        }

        75%{
            left:13px;
            transform:scale(1, 0.5);
        }

        100%{
            left:0px;
            transform:scale(0.5, 1);
        }
    }

    @-o-keyframes bounce_escapingBallG{
        0%{
            left:0px;
            -o-transform:scale(0.5, 1);
        }

        25%{
            left:13px;
            -o-transform:scale(1, 0.5);
        }

        50%{
            left:32px;
            -o-transform:scale(0.5, 1);
        }

        75%{
            left:13px;
            -o-transform:scale(1, 0.5);
        }

        100%{
            left:0px;
            -o-transform:scale(0.5, 1);
        }
    }

    @-ms-keyframes bounce_escapingBallG{
        0%{
            left:0px;
            -ms-transform:scale(0.5, 1);
        }

        25%{
            left:13px;
            -ms-transform:scale(1, 0.5);
        }

        50%{
            left:32px;
            -ms-transform:scale(0.5, 1);
        }

        75%{
            left:13px;
            -ms-transform:scale(1, 0.5);
        }

        100%{
            left:0px;
            -ms-transform:scale(0.5, 1);
        }
    }

    @-webkit-keyframes bounce_escapingBallG{
        0%{
            left:0px;
            -webkit-transform:scale(0.5, 1);
        }

        25%{
            left:13px;
            -webkit-transform:scale(1, 0.5);
        }

        50%{
            left:32px;
            -webkit-transform:scale(0.5, 1);
        }

        75%{
            left:13px;
            -webkit-transform:scale(1, 0.5);
        }

        100%{
            left:0px;
            -webkit-transform:scale(0.5, 1);
        }
    }

    @-moz-keyframes bounce_escapingBallG{
        0%{
            left:0px;
            -moz-transform:scale(0.5, 1);
        }

        25%{
            left:13px;
            -moz-transform:scale(1, 0.5);
        }

        50%{
            left:32px;
            -moz-transform:scale(0.5, 1);
        }

        75%{
            left:13px;
            -moz-transform:scale(1, 0.5);
        }

        100%{
            left:0px;
            -moz-transform:scale(0.5, 1);
        }
    }
</style>

<div id="source_associater_start_service" width="100%">
    <div>
        <h1>Source Associater Service</h1>
    </div>

    <div>
        This service allows you to start a process that will take a particular source, find all IP objects whose AS Number is found in the ASNs
        of the source, and associate those IPs with the given source.
    </div>

    <select id="source"></select>
    <button onclick="start_processing()">Just do it!</button>

    <span id="escapingBallG" style="display: none;">
        <span id="escapingBall_1" class="escapingBallG"></span>
    </span>

    <div id="status"></div>
</div>

<script>
$(document).ready(function() {
    $(document).on('click', '#start_associating', function(e) {
        $.ajax({
            type: "POST",
            url: "{% url 'source_associater_service.views.associate_ips_to_sources' %}",
            data: {},
            success: function(data) {
                toggle_loader();
            }
        });
    });

    get_source_names();
});

function get_source_names() {
        $.ajax({
            type: "GET",
            url: "{% url 'source_associater_service.views.get_all_source_names' %}",
            data: {},
            success: add_source_names_to_dropdown
        });
    }

function add_source_names_to_dropdown(data) {
    var source_names = data.source_names;
    // TODO: figure out how to get all sources loaded here
    var options = '';
    for (var x = 0; x < source_names.length; x++) {
        options += '<option value="' + source_names[x] + '">' + source_names[x] + '</option>';
    }
    $('#source').html(options);
}

function start_processing() {
    toggle_loader();
    var source_select = document.getElementById("source");
    var source_name = source_select.options[ source_select.selectedIndex ].value;
    $.ajax({
        type: "POST",
        url: "{% url 'source_associater_service.views.associate_ips_to_sources' %}",
        data: {'source_name': source_name},
        success: function(data) {
            toggle_loader();
            $('#status').html(data.message);
        }
    });
}

function toggle_loader() {
    $('#escapingBallG').toggle();
}

</script>

{% endblock %}